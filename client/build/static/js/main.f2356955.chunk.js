(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{29:function(e,t,s){},36:function(e,t,s){},38:function(e,t,s){},39:function(e,t,s){},43:function(e,t,s){},44:function(e,t,s){"use strict";s.r(t);var n=s(2),a=s.n(n),c=s(21),r=s.n(c),i=s(13),o=s(4),l=s(6),u=(s(29),s(22)),j=(s(34),s(7)),d=s.n(j),b=s(11),h=function(){var e=Object(n.useState)(!1),t=Object(l.a)(e,2),s=t[0],a=t[1],c=Object(n.useState)(null),r=Object(l.a)(c,2),i=r[0],o=r[1];return{loading:s,request:Object(n.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t){var s,n,c,r,i,l=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>1&&void 0!==l[1]?l[1]:"GET",n=l.length>2&&void 0!==l[2]?l[2]:null,c=l.length>3&&void 0!==l[3]?l[3]:{},a(!0),n&&(n=JSON.stringify(n),c["Content-Type"]="application/json",c.Accept="application/json"),e.prev=5,e.next=8,fetch(t,{method:s,body:n,headers:c});case 8:return r=e.sent,e.next=11,r.json();case 11:if(i=e.sent,r.ok){e.next=14;break}throw new Error(i.message||"Somthing wrong");case 14:return a(!1),e.abrupt("return",i);case 18:throw e.prev=18,e.t0=e.catch(5),a(!1),o(e.t0.message),e.t0;case 23:case"end":return e.stop()}}),e,null,[[5,18]])})));return function(t){return e.apply(this,arguments)}}(),[]),error:i,clearError:function(){return o(null)}}},m=s(15),O=s(12);s(36);function f(){}var p=Object(n.createContext)({token:null,username:null,userId:null,login:f,logout:f,isAuthenticated:!1}),x=s(0);function g(e){var t=Object(n.useContext)(p),s=Object(n.useState)({username:" ",password:""}),a=Object(l.a)(s,2),c=a[0],r=a[1],i=h().request;function o(e){r(Object(O.a)(Object(O.a)({},c),{},Object(m.a)({},e.target.name,e.target.value)))}function u(){return(u=Object(b.a)(d.a.mark((function s(){var n;return d.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,i("/api/login","POST",Object(O.a)({},c));case 3:if(!(n=s.sent).isCorrect){s.next=8;break}return e.setShow(),t.login(n.token,n.username,n.id,n.admin),s.abrupt("return");case 8:alert("Incorrect login"),s.next=14;break;case 11:s.prev=11,s.t0=s.catch(0),console.log(s.t0);case 14:case"end":return s.stop()}}),s,null,[[0,11]])})))).apply(this,arguments)}function j(){return(j=Object(b.a)(d.a.mark((function s(){var n;return d.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,i("/api/register","POST",Object(O.a)({},c));case 3:if(!(n=s.sent).isCorrect){s.next=8;break}return e.setShow(),t.login(n.token,n.username,n.id,n.admin),s.abrupt("return");case 8:alert(n.message),s.next=14;break;case 11:s.prev=11,s.t0=s.catch(0),console.log(s.t0);case 14:case"end":return s.stop()}}),s,null,[[0,11]])})))).apply(this,arguments)}return Object(x.jsxs)("div",{className:"auth__window",children:[Object(x.jsx)("p",{className:"auth__header",children:"Login"}),Object(x.jsxs)("div",{className:"input__item",children:[Object(x.jsx)("i",{className:"fas fa-user"}),Object(x.jsx)("input",{className:"auth__login",name:"username",placeholder:"username",type:"text",onChange:function(e){return o(e)}})]}),Object(x.jsxs)("div",{className:"input__item",children:[Object(x.jsx)("i",{className:"fas fa-key"}),Object(x.jsx)("input",{className:"auth__password",name:"password",placeholder:"password",type:"password",onChange:function(e){return o(e)}})]}),Object(x.jsx)("button",{className:"auth__btn",onClick:function(){return u.apply(this,arguments)},children:"Sign in"}),Object(x.jsx)("button",{className:"auth__btn",onClick:function(){return j.apply(this,arguments)},children:"Register"})]})}var _=function(){var e=h().request,t=Object(n.useState)(!1),s=Object(l.a)(t,2),a=s[0],c=s[1];return Object(n.useLayoutEffect)((function(){e("/api/addvisitor").catch((function(e){return console.log(e)}))}),[e]),Object(x.jsxs)("div",{className:"mainPage",children:[Object(x.jsx)("div",{className:"mainPageInner",children:Object(x.jsxs)("div",{className:"header",children:[Object(x.jsx)("h2",{className:"sub__header",children:"Nothing interesting here"}),Object(x.jsx)("h1",{className:"main__header",children:"fjodorov.ru"}),Object(x.jsx)("div",{className:"social",children:Object(x.jsxs)("div",{className:"social__icons",children:[Object(x.jsx)("a",{href:"https://www.instagram.com/fjodorov.ru/",children:Object(x.jsx)("div",{className:"icon__item",children:Object(x.jsx)("i",{className:"fab fa-instagram social__icon"})})}),Object(x.jsx)("a",{href:"https://t.me/fjodorov",children:Object(x.jsx)("div",{className:"icon__item",children:Object(x.jsx)("i",{className:"fab fa-telegram-plane social__icon"})})}),Object(x.jsx)("a",{href:"mailto:fjodorov.develop@mail.ru",children:Object(x.jsx)("div",{className:"icon__item",children:Object(x.jsx)("i",{className:"fas fa-envelope social__icon"})})}),Object(x.jsx)("div",{className:"icon__item",id:"write",onClick:function(){return function(){var t=prompt("Write me/\u041d\u0430\u043f\u0438\u0448\u0438 \u043c\u043d\u0435...");""!==t&&e("/api/write","POST",{message:t}).then((function(e){return alert(e.answer)})).catch((function(e){return alert(e)}))}()},children:Object(x.jsx)("i",{className:"fas fa-pencil-alt social__icon"})})]})})]})}),Object(x.jsx)("i",{className:"fas fa-cogs admin__login",onClick:function(){return c(!0)}}),Object(x.jsx)(u.a,{visible:a,customStyles:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:"40px 20px",width:"350px",height:"350px"},onClose:function(){return c(!1)},children:Object(x.jsx)(g,{setShow:function(){return c(!1)}})})]})};s(38);function v(){var e=Object(n.useContext)(p),t=e.token,s=e.logout,a=h().request,c=Object(n.useState)({messages:[],visits:[]}),r=Object(l.a)(c,2),i=r[0],o=r[1],u=i.messages.map((function(e,t){return Object(x.jsxs)("li",{className:"collection-item list__item",children:[Object(x.jsx)("span",{className:"li__number",children:"".concat(t,". ")}),"".concat(e.text)]},t)})),j=i.visits.map((function(e,t){return Object(x.jsxs)("li",{className:"collection-item list__item",children:[Object(x.jsx)("span",{className:"li__number",children:"".concat(e.id,". ")}),"".concat(e.ip,", ").concat(e.country)]},t)}));function d(e){a("/api/clearlist","POST",{token:t,list:e}).then((function(t){t.successful?o(Object(O.a)(Object(O.a)({},i),{},Object(m.a)({},e,[]))):s()})).catch((function(e){return alert("Error!"+e)}))}return Object(n.useEffect)((function(){a("/api/getvisitors","POST",{token:t}).then((function(e){return e.successful?o({messages:e.messages,visits:e.visits}):s()}))}),[a,t,s]),Object(x.jsxs)("div",{className:"visitors__page",children:[Object(x.jsxs)("ul",{className:"collection with-header visitors__list",children:[Object(x.jsxs)("li",{className:"collection-header",children:[Object(x.jsx)("h4",{className:"list__header",children:"Messages list"}),Object(x.jsx)("button",{className:"waves-effect waves-light btn",onClick:function(){return d("messages")},children:"CLEAR"})]}),u]}),Object(x.jsxs)("ul",{className:"collection with-header messages__list",children:[Object(x.jsxs)("li",{className:"collection-header",children:[Object(x.jsx)("h4",{className:"list__header",children:"Visitors list"}),Object(x.jsx)("button",{className:"waves-effect waves-light btn",onClick:function(){return d("visits")},children:"CLEAR"})]}),j]})]})}s(39);var N=function(){var e=h().request,t=Object(n.useContext)(p),s=t.token,a=t.userId,c=t.username,r=Object(n.useState)([]),i=Object(l.a)(r,2),o=i[0],u=i[1],j=Object(n.useState)(""),m=Object(l.a)(j,2),O=m[0],f=m[1],g=Object(n.useState)({contactId:null,messages:[]}),_=Object(l.a)(g,2),v=_[0],N=_[1],k=o.map((function(e,t){return Object(x.jsxs)("div",{className:"contacts__item",onClick:function(){return C(e)},children:[Object(x.jsx)("div",{className:"contacts__avatar",children:Object(x.jsx)("i",{className:"fas fa-user avatar"})}),Object(x.jsxs)("div",{className:"contacts__content",children:[Object(x.jsx)("h5",{className:"contancts__name",children:e.senderUsername}),Object(x.jsx)("p",{className:"contacts__lastmsg",children:e.message})]})]},t)}));Object(n.useEffect)((function(){e("/api/getcontacts","POST",{token:s}).then((function(e){u(e.dialogs)}))}),[e,s]);var w=v.messages.map((function(e,t){var s=e.messages.map((function(e,t){return Object(x.jsx)("p",{className:"dialog__msg",children:e},t)}));return Object(x.jsxs)("div",{className:"dialog__item",children:[Object(x.jsx)("div",{className:"dialog__avatar",children:Object(x.jsx)("i",{className:"fas fa-user avatar"})}),Object(x.jsxs)("div",{className:"dialog__content",children:[Object(x.jsx)("h5",{className:"dialog__name",children:e.sender}),s]})]},t)}));function S(){return(S=Object(b.a)(d.a.mark((function t(){var n,c;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==O){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e("/api/sendmessage","POST",{sender:a,recipient:v.contactId,message:O,token:s});case 4:n=v,v.messages[0].sender===a?n.messages[0].messages.push(O):n.messages.unshift({messages:[O],sender:a,recipient:v.contactId,time:(new Date).getDate()}),(c=o).forEach((function(e){e.sender_id!==v.contactId&&e.recipient_id!==v.contactId||(e.message=O,e.sender_id=a,e.recipient_id=v.contactId)})),u(c),N(n),f("");case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(e){return y.apply(this,arguments)}function y(){return(y=Object(b.a)(d.a.mark((function t(n){var c,r,i,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=n.sender_id!==a?n.sender_id:n.recipient_id,t.next=3,e("/api/loadmessages","POST",{idOne:n.sender_id,idTwo:n.recipient_id,token:s});case 3:r=t.sent,(i=r.messages).sort((function(e,t){return new Date(t.created_at)-new Date(e.created_at)})),o=[],i.forEach((function(e){o.length>0&&e.sender_id===o[o.length-1].sender?o[o.length-1].messages.push(e.message):o.push({sender:e.sender_id,recipient:e.recipient_id,time:e.created_at,messages:[e.message]})})),o.forEach((function(e){e.messages.reverse()})),N({messages:o,contactId:c});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(){return(I=Object(b.a)(d.a.mark((function t(){var n,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=prompt("\u0412\u0432\u0435\u0434\u0438 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0445\u043e\u0442\u0438\u0442\u0435 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c"))!==c){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e("/api/getid","POST",{token:s,username:n});case 5:r=t.sent,console.log(r),r.id||alert("\u041d\u0435\u0442 \u0442\u0430\u043a\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"),C({sender_id:a,recipient_id:r.id});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(x.jsx)("div",{className:"messanger__container",children:Object(x.jsxs)("div",{className:"messanger__inner",children:[Object(x.jsx)("i",{onClick:function(){return function(){return I.apply(this,arguments)}()},className:"fas fa-arrow-circle-right send_arrow"}),Object(x.jsx)("div",{className:"contacts",children:k||null}),Object(x.jsxs)("div",{className:"dialog",children:[Object(x.jsx)("div",{className:"dialog__head"}),Object(x.jsx)("div",{className:"dialog__body",children:w||null}),Object(x.jsxs)("div",{className:"dialog__footer",children:[Object(x.jsx)("textarea",{value:O,onChange:function(e){return function(e){f(e.target.value)}(e)}}),Object(x.jsx)("i",{onClick:function(){return function(){return S.apply(this,arguments)}()},className:"fas fa-arrow-circle-right send_arrow"})]})]})]})})},k="userData";s(43);function w(){var e=Object(n.useContext)(p),t=e.logout,s=e.isAdmin;return Object(x.jsx)("nav",{className:"navigation",children:Object(x.jsxs)("div",{className:"nav-wrapper",children:[Object(x.jsx)("a",{href:"/",className:"brand-logo",children:"Admin menu"}),Object(x.jsxs)("ul",{id:"nav-mobile",className:"right hide-on-med-and-down",children:[Object(x.jsx)("li",{children:Object(x.jsx)(i.b,{to:"/",children:"Main"})}),s?Object(x.jsx)("li",{children:Object(x.jsx)(i.b,{to:"/visitorslist",children:"Visitors list"})}):null,Object(x.jsx)("li",{children:Object(x.jsx)(i.b,{to:"/messanger",children:"Messanger"})}),Object(x.jsx)("li",{onClick:function(){return t()},children:Object(x.jsx)("a",{href:"/",children:"EXIT"})})]})]})})}var S=function(){var e=function(){var e=Object(n.useState)(null),t=Object(l.a)(e,2),s=t[0],a=t[1],c=Object(n.useState)(null),r=Object(l.a)(c,2),i=r[0],o=r[1],u=Object(n.useState)(null),j=Object(l.a)(u,2),d=j[0],b=j[1],m=Object(n.useState)(0),O=Object(l.a)(m,2),f=O[0],p=O[1],x=h().request,g=Object(n.useCallback)((function(e,t,s){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a(e),o(t),b(s),p(n),localStorage.setItem(k,JSON.stringify({username:t,userId:s,token:e,admin:n}))}),[]),_=Object(n.useCallback)((function(){a(null),o(null),b(null),p(0),localStorage.removeItem(k)}),[]);return Object(n.useEffect)((function(){var e=JSON.parse(localStorage.getItem(k));e&&e.token&&x("/api/checkauth","POST",{token:e.token}).then((function(t){t.authenticated?g(e.token,e.username,e.userId,e.admin):_()}))}),[g,_,x]),{login:g,logout:_,token:s,username:i,userId:d,isAdmin:f}}(),t=e.token,s=e.username,a=e.userId,c=e.login,r=e.logout,u=e.isAdmin,j=!!t,d=function(e){return e?Object(x.jsxs)(o.d,{children:[Object(x.jsx)(o.b,{path:"/",exact:!0,children:Object(x.jsx)(_,{})}),Object(x.jsx)(o.b,{path:"/visitorslist",exact:!0,children:Object(x.jsx)(v,{})}),Object(x.jsx)(o.b,{path:"/messanger",exact:!0,children:Object(x.jsx)(N,{})})]}):Object(x.jsxs)(o.d,{children:[Object(x.jsx)(o.b,{path:"/",exact:!0,children:Object(x.jsx)(_,{})}),Object(x.jsx)(o.a,{to:"/"})]})}(j);return Object(x.jsx)(p.Provider,{value:{token:t,username:s,userId:a,login:c,logout:r,isAuthenticated:j,isAdmin:u},children:Object(x.jsxs)(i.a,{children:[j?Object(x.jsx)(w,{}):"",Object(x.jsx)("div",{className:"myContainer",children:d})]})})};r.a.render(Object(x.jsx)(a.a.StrictMode,{children:Object(x.jsx)(S,{})}),document.getElementById("root"))}},[[44,1,2]]]);
//# sourceMappingURL=main.f2356955.chunk.js.map